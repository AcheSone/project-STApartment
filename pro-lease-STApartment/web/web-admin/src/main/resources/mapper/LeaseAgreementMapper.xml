<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.baidu.lease.web.admin.mapper.LeaseAgreementMapper">

    <select id="pageAgreementByQuery" resultType="com.baidu.lease.web.admin.vo.agreement.AgreementVo">
        select t1.*,
        t2.name as 'apartmentInfo.name',
        t2.province_name as 'apartmentInfo.provinceName',
        t2.city_name as 'apartmentInfo.cityName',
        t2.district_name as 'apartmentInfo.districtName',
        t3.room_number as 'roomInfo.roomNumber',
        t4.month_count as 'leaseTerm.monthCount',
        t5.name as 'paymentType.name'
        from lease_agreement t1
        left join
        apartment_info t2 on t1.apartment_id = t2.id and t1.is_deleted = 0
        left join
        room_info t3 on t1.room_id = t3.id and t3.is_deleted = 0
        left join
        lease_term t4 on t1.lease_term_id = t4.id
        left join
        payment_type t5 on t1.payment_type_id = t5.id
        <where>
            <if test="queryVo.name != null and queryVo.name !=  ''">
                and t1.name like concat('%' #{queryVo.name} '%')
            </if>
            <if test="queryVo.phone != null and queryVo.phone !=  ''">
                and t1.phone like concat('%' #{queryVo.phone} '%')
            </if>
            <if test="queryVo.roomNumber != null and queryVo.roomNumber !=  ''">
                and t3.room_number = #{queryVo.roomNumber}
            </if>
            <if test="queryVo.provinceId != null">
                and t2.province_Id = #{queryVo.provinceId}
            </if>
            <if test="queryVo.cityId != null">
                and t2.city_Id = #{queryVo.cityId}
            </if>
            <if test="queryVo.districtId != null">
                and t2.district_Id = #{queryVo.districtId}
            </if>
            <if test="queryVo.apartmentId != null">
                and t2.apartment_id = #{queryVo.apartmentId}
            </if>
        </where>
    </select>
    <select id="getAgreementById" resultType="com.baidu.lease.web.admin.vo.agreement.AgreementVo">
        select t1.*,
               t2.name as 'apartmentInfo.name',
                t2.province_name as 'apartmentInfo.provinceName',
                t2.city_name as 'apartmentInfo.cityName',
                t2.district_name as 'apartmentInfo.districtName',
                t3.room_number as 'roomInfo.roomNumber',
                t4.month_count as 'leaseTerm.monthCount',
                t5.name as 'paymentType.name'
        from lease_agreement t1
                 left join
             apartment_info t2 on t1.apartment_id = t2.id and t1.is_deleted = 0
                 left join
             room_info t3 on t1.room_id = t3.id and t3.is_deleted = 0
                 left join
             lease_term t4 on t1.lease_term_id = t4.id
                 left join
             payment_type t5 on t1.payment_type_id = t5.id
where t1.id = #{id}
    </select>

</mapper>
