<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.baidu.lease.web.admin.mapper.FacilityInfoMapper">

    <select id="selectListByApartmentId" resultType="com.baidu.lease.model.entity.FacilityInfo">
        select t3.type, t3.name, t3.icon, t3.id
        from (select t1.name, t1.type, t1.icon, t2.apartment_id, t1.is_deleted, t1.id
              from facility_info t1
                       left join apartment_facility t2
                                 on t1.id = t2.facility_id
                                     and t1.is_deleted = 0 and t2.is_deleted = 0) t3
                 left join apartment_info t4
                           on t3.apartment_id = t4.id and t3.is_deleted = 0
        where t3.apartment_id = #{id}
          and t3.type = 1

    </select>

    <select id="selectFacilityInfo" resultType="com.baidu.lease.model.entity.FacilityInfo">
        select t3.*
        from (select t1.*, t2.room_id
              from facility_info t1
                       left join
                   room_facility t2
                   on t1.id = t2.facility_id
              where t1.is_deleted = 0
                and t2.is_deleted = 0
                and t1.type = 2) t3
                 left join
             room_info t4
             on t3.room_id = t4.id
        where t4.id = #{id};
    </select>
    <!--上面一段可以这样优化，上面的操作是根据id进行房间的配套信息查询，因为一个房间对应多个配套，
    所以是一对多的关系，又因为是根据facilityInfo这个实体类作为实体类接收查询结果，所以涉及了三张表，
    房间、房间-配套中间表、配套表。但是这里仅查询配套表中所有与某个房间相关联的信息，不涉及房间其他信息，
    所以可以仅通过连接中间表（中间表有房间id和配套id）和配套表（拥有配套id），进行配套表中，属于某个房间的配套设施查询
select * from facility_info t1 where is_deleted = 0
and t1.id in
(select facility_id from room_facility where t1.is_deleted =0 and room_id = 2)

    -->

</mapper>
